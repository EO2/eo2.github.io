<h1>Open Studio (alpha:0.1)</h1>
<h2>Play, Record, View, Listen.. Learn!</h2>

<p>Audio Analyzer (HTML Audio + Web Audio API) - Stream or file reader</p>

<!-- <audio></audio> -->
<script>
// Create an <audio> element dynamically.
var audio = new Audio();
audio.src = 'http://selected.deepmix.ru/Dima_Algoritm.mp3' // 'recording1.mp4 (multitrack)
audio.controls = true;
audio.autoplay = true;
document.body.appendChild(audio);

var context = new AudioContext();
var analyser = context.createAnalyser();

// Wait for window.onload to fire. See crbug.com/112368
window.addEventListener('load', function(e) {
  // Our <audio> element will be the audio source.
  var source = context.createMediaElementSource(audio);
  source.connect(analyser);
  analyser.connect(context.destination);

  // ...call requestAnimationFrame() and render the analyser's output to canvas.
  requestAnimationFrame(draw);
}, false);

function draw() {
  //drawVisual = requestAnimationFrame(draw);
  analyser.getByteTimeDomainData(dataArray);
  
  canvasCtx.fillStyle = 'rgb(200, 200, 200)';
  canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);
  canvasCtx.lineWidth = 2;
  canvasCtx.strokeStyle = 'rgb(0, 0, 0)';
  canvasCtx.beginPath();
  
  var sliceWidth = WIDTH * 1.0 / bufferLength;
  var x = 0;
  
  for (var i = 0; i < bufferLength; i++) {
    var v = dataArray[i] / 128.0;
    var y = v * HEIGTH / 2;
    
    if (i === 0) {
      canvasCtx.moveTo(x, y);
    } else {
      canvasCtx.lineTo(x, y);
    }
    
    x += sliceWidth;
    
    canvasCtx.lineTo(canvas.width, canvas.height / 2);
    canvasCtx.stroke();
  }
}
</script>
